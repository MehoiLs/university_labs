# Лабораторная работа 3

Необходимо разработать схему базы данных из любой предметной области (можно взять то же самое, 
что взяли на курсе по БД и упростить, но нельзя брать предметную область из примера по ссылке). 
Предметные у каждого должны быть индивидуальные, так что договаривайтесь и "столбите" заранее. 
Повторения не принимаются

Требования к схеме следующие:
1) Схема должна содержать минимум одну связь один к одному 
(пример - студент-номер телефона или студент-адрес проживания)
2) Схема должна содержать минимум одну связь один ко многим 
(пример - группа-студент)
3) Схема должна содержать минимум одну связь многие ко многим 
(пример - курс по выбору-студент)
4) Должны быть описаны первичные ключи где необходимо
5) Первичные ключи должны быть автосгенерированы на уровне БД при добавлении сущности в таблицу
6) Должны быть описаны внешние ключи где необходимо
7) Должны быть описаны ограничения на данные, вставляемые в таблицу, где это необходимо 
(обязательные поля, максимальная длинна поля и т.п.)

Требуется с помощью **Entity Framework** и подхода **Code First** поднять эту базу данных. 
Для сдачи достаточно приложения (можно сделать отдельное консольное приложение, можно объединить 
со следующими частями лабораторных (тем, кто претендует на автомат), рекомендую объединить), 
которое подключается к пустой базе данных и при первом запуске прогоняет миграции на создание 
таблиц (учитывать, что при повторных запусках нужна проверка на то, что таблицы уже существуют, 
т.е. они не должны пересоздаваться)

_В качестве БД-сервера можно использовать сервер MSSQLLocalDB (требуется заранее установить 
как компонент через VS Installer, после чего его можно будет найти пройдя по пути 
Вид -> Обозреватель объектов SQL Server. Там же можно создать пустую БД в пару кликов и 
там же можно получить строку подключения к этой БД)_

Перед выполнением будет полезно изучить:
https://www.entityframeworktutorial.net/code-first/what-is-code-first.aspx

## Для автомата (на 4)
В дополнении к предыдущим требованиям вместо консольного приложения необходимо реализовать web-api 
приложение на основе контроллеров. Демонстрация работоспособности будет проводиться через Swagger

Требования к приложению следующие:
1) Приложение должно содержать класс, который отвечает за CRUD-операции с БД, который 
через контекст будет манипулировать данными. Учтите, что такой класс должен быть только один
и должен уметь манипулировать данными из любых таблиц (т.е. это должен быть обобщённый класс)
2) Приложение должно содержать контроллеры, обрабатывающие HTTP запросы (Post, Get, Put/Patch, Delete), 
которые обращаются к классу из п.1. для добавления, получения, обновления и удаления данных в БД
3) Приложение должно валидировать данные, соответственно существующим ограничениям, которые были 
навешаны на данные, вставляемые в таблицу в БД. (Подсказка: на вход эндпоинтам контроллеров, 
обрабатывающим Post-запросы подавать `ViewModel` сущностей, которые будут трансформироваться в `Entity`, 
которые будут писаться в БД. Во `ViewModel`-классах можно прибегнуть к `System.ComponentModel.DataAnnotations`).
При передаче каких-либо невалидных моделей приложение должно выдавать вразумительный ответ об ошибке 
(Статус-коды и классы ошибок могут помочь)
4) Приложение должно содержать все необходимые GET-запросы для демонстрации всех связей из п.1-3 
предыдущего раздела
5) При реализации DELETE-запросов предусмотреть каскадное удаление там, где это логически требуется

Перед выполнением будет полезно изучить:
https://learn.microsoft.com/ru-ru/aspnet/core/tutorials/first-web-api?view=aspnetcore-8.0


# Схема БД
База данных сети отелей

У каждого отеля, входящего в сеть, есть название, адрес,
e-mail, телефон, год открытия, площадь, владелец. У одного вла-
дельца может быть несколько отелей.

Каждый отель располагает набором номеров, распределен-
ных по этажам отеля. Номера отеля могут быть разных типов
(эконом-класс одноместный, люкс, апартаменты, стандартный
двухместный номер с одной кроватью, стандартный двухместный
номер с двумя отдельными кроватями и т. п.), которые характери-
зуются количеством мест в номере и видом (люкс, эконом-класс,
бизнес-класс). В отеле действует система тарифов, которая опре-
деляет стоимость номера. В БД должна фиксироваться информа-
ция о стоимости каждого типа номера, описание тарифа, дата на-
чала действия тарифа.

Каждый тип номера имеет свою цену проживания за сутки и
дополнительные характеристики. В одном номере может прожи-
вать несколько человек, если номер многоместный. При этом один
и тот же клиент в разное время может проживать в разных номе-
рах. Каждый номер относится строго к одному виду. В то же вре-
мя к одному виду может относиться несколько номеров.

Основной деятельностью отеля является размещение клиен-
тов в номерах с возможностью предварительного бронирования
номера, а также оказание дополнительных услуг. Оплата прожи-
вания и дополнительных услуг осуществляется на основании вы-
ставляемого счета.

Перед приездом клиент бронирует один или несколько номе-
ров. При бронировании указываются класс номера, планируемая
дата заселения и дата выезда. Администратор гостиницы фикси-
рует эту информацию в журнале бронирования. В запись о брони-
ровании номера вносятся сведения о клиенте, бронирующем но-
мер (фамилия, имя, отчество, паспортные данные).

Когда клиент прибывает в гостиницу, администратор органи-
зовывает заселение клиента в номер. Проживание может быть
оформлено как на основании предварительного бронирования, так
и без бронирования при наличии свободных номеров.

Счета, выставляемые клиентам, делятся на две группы: счета
за проживание и счета за дополнительные услуги.

Во время проживания клиента в отеле он может воспользо-
ваться дополнительными платными услугами. При этом создается
один или несколько счетов на дополнительные услуги, в котором
указываются перечень предоставленных услуг, их количество и
цена. В рамках одного счета клиенту может быть оказано не-
сколько услуг. При этом одна и та же услуга может быть оказана
нескольким клиентам по разным счетам, с разной стоимостью и в
различном количестве.

При нанесении вреда отелю клиенту может быть выписан
штраф. Штрафы разделяются по видам. В БД должна фиксиро-
ваться информация о дате штрафа.

Кроме того, в БД должна содержаться информация о сотруд-
никах и обслуживающем персонале. Например, часть сотрудников
закреплена за конкретными номерами (например, горничные).
Данные сотрудников: фамилия, имя, отчество, дата рождения,
паспортные данные, наименование вида работ, выполняемых со-
трудником, оклад (зависит от вида работ).